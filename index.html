<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>정책 실행 랩 백신 연구소</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif; /* Noto Sans KR 폰트 적용 */
            background-color: #0a0a0a; /* 완전한 검정색에 가까운 배경 */
            color: #00ff00; /* 밝은 녹색 텍스트 */
            text-shadow: 0 0 5px #00ff00, 0 0 2px #00ff00; /* 텍스트 네온 'glow' 효과 */
            overflow: hidden; /* 바이러스가 화면 밖으로 나가도 스크롤 생기지 않게 */
            position: relative; /* 바이러스 위치 지정을 위해 */
        }

        /* 바이러스 애니메이션 */
        @keyframes float {
            0% { transform: translate(0, 0) rotate(0deg); opacity: 0.7; }
            25% { transform: translate(20px, 10px) rotate(5deg); opacity: 0.8; }
            50% { transform: translate(0, 20px) rotate(0deg); opacity: 0.9; }
            75% { transform: translate(-20px, 10px) rotate(-5deg); opacity: 0.8; }
            100% { transform: translate(0, 0) rotate(0deg); opacity: 0.7; }
        }

        .virus-icon {
            position: absolute;
            font-size: 3rem; /* 바이러스 아이콘 크기 */
            color: rgba(0, 255, 0, 0.4); /* 투명한 녹색 */
            animation: float 10s ease-in-out infinite; /* 애니메이션 적용 */
            pointer-events: none; /* 클릭 방지 */
            z-index: 0; /* 다른 요소 뒤에 */
            text-shadow: 0 0 10px rgba(0, 255, 0, 0.6);
        }

        /* 공통 레트로 버튼 스타일 */
        .btn-retro {
            display: inline-block;
            padding: 10px 20px;
            font-size: 1.1rem;
            color: #00ff00;
            background-color: #1a1a1a;
            border: 2px solid #00ff00;
            box-shadow: inset 0 0 5px #00ff00, 0 0 5px #00ff00;
            transition: all 0.2s ease;
            cursor: pointer;
            z-index: 10; /* 다른 요소 위에 */
            position: relative;
        }
        .btn-retro:hover {
            color: #0a0a0a;
            background-color: #00ff00;
            box-shadow: inset 0 0 10px #000000, 0 0 15px #00ff00;
        }
        .btn-retro:active {
            transform: translateY(2px);
        }

        /* 키워드 박스 */
        .keyword-box {
            @apply flex flex-col items-center justify-center p-4 text-center break-keep;
            background-color: #111;
            border: 2px solid #008f00;
            color: #00ff00;
            min-height: 100px;
            font-size: 1.2rem;
            transition: all 0.2s ease;
            cursor: pointer;
            position: relative; /* z-index를 위해 추가 */
            z-index: 5;
        }
        .keyword-box:hover {
            background-color: #222;
            border-color: #00ff00;
            box-shadow: 0 0 10px #00ff00;
        }

        /* 모달 오버레이 (가운데 정렬) */
        .modal-overlay {
            @apply fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4;
            z-index: 100; /* 최상단 */
        }

        /* 모달 컨텐츠 박스 (이미지 참고 디자인) */
        .modal-box {
            @apply bg-gray-900 p-6 shadow-lg relative rounded-lg; /* 둥근 모서리 추가 */
            border: 2px solid #5a00ff; /* 보라색 계열 테두리 */
            box-shadow: 0 0 20px #5a00ff; /* 보라색 계열 그림자 */
            width: 90%;
            max-width: 600px;
            color: #e0e0e0; /* 모달 내 텍스트 색상 */
            background: linear-gradient(145deg, #1a1a1a, #0a0a0a); /* 그라데이션 배경 */
        }

        /* 모달 질문 텍스트 */
        .modal-box .quiz-question-text {
            color: #fff; /* 질문 텍스트는 흰색 */
            font-weight: bold;
            font-size: 1.3rem;
            margin-bottom: 1.5rem;
            text-shadow: none; /* 네온 효과 제거 */
            border-bottom: 1px solid rgba(255, 255, 255, 0.2); /* 하단 라인 */
            padding-bottom: 1rem;
        }

        /* 모달 닫기 버튼 */
        .modal-close-btn {
            @apply absolute top-3 right-4 text-3xl text-gray-400 hover:text-white;
            text-shadow: none;
            cursor: pointer;
        }

        /* MCQ 옵션 버튼 (이미지 참고 디자인) */
        .mcq-option {
            @apply w-full p-4 my-2 text-left relative rounded-md; /* 둥근 모서리 */
            background-color: #2a2a2a; /* 어두운 배경 */
            border: 1px solid #444; /* 연한 테두리 */
            color: #e0e0e0; /* 텍스트 색상 */
            transition: all 0.2s ease;
            cursor: pointer;
            text-shadow: none;

            /* 라디오 버튼처럼 보이게 하는 원형 아이콘 */
            padding-left: 3rem; /* 원형 아이콘 공간 확보 */
        }
        .mcq-option::before {
            content: '';
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            width: 18px;
            height: 18px;
            border: 2px solid #777;
            border-radius: 50%;
            background-color: #3a3a3a;
        }
        .mcq-option:hover {
            background-color: #3a3a3a;
            border-color: #888;
        }
        /* 선택된 MCQ 옵션 */
        .mcq-option.selected {
            background-color: #5a00ff; /* 보라색 계열 배경 */
            border-color: #5a00ff;
            color: #fff;
            box-shadow: 0 0 15px rgba(90, 0, 255, 0.6);
        }
        .mcq-option.selected::before {
            background-color: #fff; /* 선택 시 원형 채우기 */
            border-color: #fff;
        }
        /* 정답 시 */
        .mcq-option.correct-answer {
            background-color: #008f00; /* 녹색 배경 */
            border-color: #00ff00;
            color: #fff;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.6);
        }
        .mcq-option.correct-answer::before {
            background-color: #fff;
            border-color: #fff;
        }
        /* 오답 시 */
        .mcq-option.wrong-answer {
            background-color: #8f0000; /* 빨간색 배경 */
            border-color: #ff0000;
            color: #fff;
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.6);
        }
        .mcq-option.wrong-answer::before {
            background-color: #fff;
            border-color: #fff;
        }
        
        /* 단답형 입력 */
        .short-answer-input {
            @apply w-full p-3 bg-gray-800 border-2 border-green-500 text-green-400 focus:outline-none focus:border-green-300 rounded-md;
            text-shadow: none;
            margin-bottom: 1rem;
        }

        /* 빛나는 아이콘/텍스트 */
        .glow {
            color: #00ff00;
            text-shadow: 0 0 8px #00ff00, 0 0 10px #00ff00;
        }
    </style>
</head>
<body class="min-h-screen p-4 relative">

    <div id="virusContainer"></div>

    <div id="startScreen" class="flex flex-col items-center justify-center min-h-[80vh] text-center relative z-10">
        <i class="fa-solid fa-flask-vial fa-4x glow mb-6"></i>
        <h1 class="text-3xl md:text-5xl font-bold mb-4">정책 실행 랩 백신 연구소</h1>
        <p class="text-xl md:text-2xl mb-8">[ 백신 개발에 참여하시겠습니까? ]</p>
        <div>
            <button id="startButton" class="btn-retro mx-2">
                <i class="fa-solid fa-check mr-2"></i> 예
            </button>
            <button class="btn-retro mx-2 opacity-50 cursor-not-allowed" title="이 연구소에서 '아니오'는 없습니다.">
                <i class="fa-solid fa-times mr-2"></i> 아니오
            </button>
        </div>
    </div>

    <div id="gameScreen" class="hidden max-w-4xl mx-auto relative z-10">
        <div class="border-2 border-green-500 p-4 mb-6">
            <h2 class="text-xl font-bold mb-2">:: 연구소 지침 ::</h2>
            <p>문제를 풀 때마다 재료를 하나씩 모으게 되며, 세 개의 재료를 통해 백신을 제작할 수 있습니다. 자신 있는 키워드의 문제를 풀어주시기 바랍니다.</p>
            
            <h3 class="mt-4 text-lg font-bold">:: 백신 재료 획득 현황 ::</h3>
            <div id="ingredientSlots" class="flex space-x-4 text-4xl mt-2">
                </div>
        </div>

        <div id="keywordGrid" class="grid grid-cols-2 md:grid-cols-5 gap-4">
            </div>
    </div>

    <div id="quizModal" class="modal-overlay hidden">
        <div class="modal-box">
            <button id="closeModalButton" class="modal-close-btn">&times;</button>
            
            <p class="text-sm text-gray-400 mb-2">질문 <span id="quizNumber"></span></p>
            <h3 class="quiz-question-text" id="quizQuestion">
                </h3>

            <div id="quizAnswerArea" class="my-4">
                </div>
            
            <button id="submitAnswerButton" class="btn-retro w-full mt-4 hidden">
                <i class="fa-solid fa-paper-plane mr-2"></i> 답변 제출
            </button>

            <p id="quizResult" class="mt-4 text-lg text-center font-bold h-6"></p>
        </div>
    </div>

    <div id="completionModal" class="modal-overlay hidden">
        <div class="modal-box text-center">
            <i class="fa-solid fa-award fa-4x glow mb-6"></i>
            <h2 class="text-3xl font-bold mb-4">백신 개발 완료!</h2>
            <p class="text-xl mb-8">도움을 주셔서 감사합니다!</p>
            <button id="resetButton" class="btn-retro">
                <i class="fa-solid fa-rotate-left mr-2"></i> 처음으로
            </button>
        </div>
    </div>

    <script>
        // --- 1. 퀴즈 데이터 정의 ---
        const quizzes = [
            {
                id: 1,
                keyword: "뇌 손상",
                type: "mcq",
                question: "심정지 상황에서 뇌 손상을 최소화하기 위해서는 몇 분 이내에 심폐소생술을 시작하는 것이 가장 좋을까요?",
                options: [
                    { text: "① 4분", correct: true },
                    { text: "② 10분", correct: false },
                    { text: "③ 20분", correct: false }
                ]
            },
            {
                id: 2,
                keyword: "응급처치",
                type: "mcq",
                question: "응급처치를 시행하기 전 가장 먼저 해야 할 일은 무엇일까요?",
                options: [
                    { text: "① 119 신고하기", correct: false },
                    { text: "② 환자에게 물 주기", correct: false },
                    { text: "③ 자신의 안전 확보하기", correct: true }
                ]
            },
            {
                id: 3,
                keyword: "심폐소생술",
                type: "mcq",
                question: "심폐소생술을 시작할 때 첫 번째 단계로 해야 할 일은 무엇일까요?",
                options: [
                    { text: "① 반응 확인", correct: true },
                    { text: "② 나이 확인", correct: false },
                    { text: "③ 성별 확인", correct: false }
                ]
            },
            {
                id: 4,
                keyword: "자동심장<br>충격기", // 줄바꿈 적용
                type: "mcq",
                question: "자동심장충격기(AED)를 사용할 때 올바른 방법은 무엇일까요?",
                options: [
                    { text: "① 전원 켜고 음성 안내를 따른다.", correct: true },
                    { text: "② 가슴 압박을 멈추고 패드를 아무 데나 붙인다.", correct: false },
                    { text: "③ 패드를 붙이기 전 몸을 흔들어 깨운다.", correct: false }
                ]
            },
            {
                id: 5,
                keyword: "화상",
                type: "mcq",
                question: "화상을 입었을 때 올바른 응급처치로 알맞은 것은 무엇일까요?",
                options: [
                    { text: "① 얼음을 직접 댄다.", correct: false },
                    { text: "② 최소 15분 이상 흐르는 찬물로 식힌다.", correct: true },
                    { text: "③ 따뜻한 수건으로 감싼다.", correct: false }
                ]
            },
            {
                id: 6,
                keyword: "가슴 압박",
                type: "mcq",
                question: "심폐소생술 중 가슴 압박을 하는 가장 큰 이유는 무엇일까요?",
                options: [
                    { text: "① 뇌에 혈류를 공급하기 위해", correct: true },
                    { text: "② 심장을 쉬게 하기 위해", correct: false },
                    { text: "③ 폐 속 공기를 제거하기 위해", correct: false }
                ]
            },
            {
                id: 7,
                keyword: "의식소실",
                type: "mcq",
                question: "쓰러진 환자를 발견했다. 환자의 반응이 없을 때 해야 할 올바른 행동은 무엇일까요?",
                options: [
                    { text: "① 119에 신고한다.", correct: true },
                    { text: "② 차가운 물을 가져온다.", correct: false },
                    { text: "③ 인공호흡을 바로 한다.", correct: false }
                ]
            },
            {
                id: 8,
                keyword: "부상자 이동",
                type: "mcq",
                question: "부상자를 이동시켜야 할 때 올바른 방법은?",
                options: [
                    { text: "① 부상 부위를 먼저 잡아 끈다.", correct: false },
                    { text: "② 고정하지 않고 바로 옮긴다.", correct: false },
                    { text: "③ 부목으로 고정한 뒤 이송한다.", correct: true }
                ]
            },
            {
                id: 9,
                keyword: "기도폐쇄",
                type: "mcq",
                question: "기도가 막힌 사람에게 실시하는 응급처치 방법은?",
                options: [
                    { text: "① 하임리히법", correct: true },
                    { text: "② 이마 내리고 턱 들어올리기법", correct: false },
                    { text: "③ 붕대법", correct: false }
                ]
            },
            {
                id: 10,
                keyword: "신고",
                type: "mcq",
                question: "심폐소생술 시 119 신고와 AED 요청을 할 때 가장 바람직한 행동은?",
                options: [
                    { text: "① 조용히 혼자 신고한다.", correct: false },
                    { text: "② 큰 소리로 주변 사람을 지목하여 요청한다.", correct: true },
                    { text: "③ AED 없이도 그냥 압박만 한다.", correct: false }
                ]
            }
        ];

        // --- 2. DOM 요소 선택 ---
        const startScreen = document.getElementById('startScreen');
        const gameScreen = document.getElementById('gameScreen');
        const startButton = document.getElementById('startButton');
        
        const ingredientSlots = document.getElementById('ingredientSlots');
        const keywordGrid = document.getElementById('keywordGrid');

        const quizModal = document.getElementById('quizModal');
        const closeModalButton = document.getElementById('closeModalButton');
        const quizQuestion = document.getElementById('quizQuestion');
        const quizNumber = document.getElementById('quizNumber');
        const quizAnswerArea = document.getElementById('quizAnswerArea');
        const submitAnswerButton = document.getElementById('submitAnswerButton');
        const quizResult = document.getElementById('quizResult');

        const completionModal = document.getElementById('completionModal');
        const resetButton = document.getElementById('resetButton');

        const virusContainer = document.getElementById('virusContainer');


        // --- 3. 게임 상태 변수 ---
        let collectedIngredients = 0;
        let currentQuiz = null;
        let currentButtonElement = null;
        let selectedOptionButton = null; // MCQ에서 선택된 버튼 추적

        // --- 4. 바이러스 아이콘 생성 및 애니메이션 ---
        function createVirusIcons(count) {
            for (let i = 0; i < count; i++) {
                const virus = document.createElement('i');
                virus.className = 'fa-solid fa-virus virus-icon';
                
                // 랜덤 초기 위치 및 애니메이션 지연
                virus.style.left = `${Math.random() * 100}vw`;
                virus.style.top = `${Math.random() * 100}vh`;
                virus.style.animationDelay = `${Math.random() * 10}s`; // 애니메이션 시작 시간 지연
                virus.style.animationDuration = `${10 + Math.random() * 10}s`; // 애니메이션 속도 랜덤화
                
                virusContainer.appendChild(virus);
            }
        }

        // --- 5. 핵심 함수 ---

        // 게임 초기화 (키워드 버튼 생성)
        function initGame() {
            keywordGrid.innerHTML = ''; // 그리드 비우기
            quizzes.forEach(quiz => {
                const button = document.createElement('button');
                button.className = 'keyword-box';
                button.setAttribute('data-quiz-id', quiz.id);
                button.innerHTML = `<i class="fa-solid fa-file-alt fa-2x mb-2"></i> <span class="text-lg">${quiz.keyword}</span>`;
                keywordGrid.appendChild(button);
            });
            updateIngredientUI();
            collectedIngredients = 0; // 초기화 시 재료도 초기화
        }

        // 게임 시작
        function startGame() {
            startScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            collectedIngredients = 0; // 재료 초기화
            updateIngredientUI();
            
            // 모든 키워드 버튼 다시 보이게
            document.querySelectorAll('.keyword-box').forEach(btn => {
                btn.classList.remove('hidden');
                btn.disabled = false;
            });
        }

        // 게임 리셋
        function resetGame() {
            completionModal.classList.add('hidden');
            gameScreen.classList.add('hidden');
            startScreen.classList.remove('hidden');
            initGame(); // initGame()을 다시 호출하여 버튼을 재생성하고 UI를 초기화합니다.
        }

        // 재료 UI 업데이트
        function updateIngredientUI() {
            ingredientSlots.innerHTML = '';
            for (let i = 0; i < 3; i++) {
                if (i < collectedIngredients) {
                    ingredientSlots.innerHTML += '<i class="fa-solid fa-vial-virus glow"></i>';
                } else {
                    ingredientSlots.innerHTML += '<i class="fa-regular fa-circle opacity-50"></i>';
                }
            }
        }

        // 키워드 클릭 처리 (이벤트 위임)
        function handleKeywordClick(e) {
            const button = e.target.closest('.keyword-box');
            if (!button || button.disabled) return;

            const quizId = button.getAttribute('data-quiz-id');
            currentQuiz = quizzes.find(q => q.id == quizId);
            currentButtonElement = button; // 현재 클릭된 버튼 저장

            openQuizModal(currentQuiz);
        }

        // 퀴즈 모달 열기
        function openQuizModal(quiz) {
            quizNumber.textContent = quiz.id; // 퀴즈 번호 표시
            quizQuestion.innerHTML = quiz.question; // HTML 태그(줄바꿈) 포함 가능하도록 innerHTML 사용
            quizAnswerArea.innerHTML = ''; // 답변 영역 초기화
            quizResult.textContent = ''; // 결과 메시지 초기화
            submitAnswerButton.classList.add('hidden'); // 제출 버튼 숨기기 (MCQ는 자체적으로 처리)
            submitAnswerButton.onclick = null; // 이전 클릭 이벤트 제거
            selectedOptionButton = null; // 선택된 옵션 초기화


            if (quiz.type === 'short') {
                quizAnswerArea.innerHTML = '<input type="text" id="shortAnswerInput" class="short-answer-input" placeholder="정답을 입력하세요...">';
                submitAnswerButton.classList.remove('hidden'); // 단답형일 때만 제출 버튼 표시
                submitAnswerButton.onclick = checkShortAnswer;
            } else if (quiz.type === 'mcq') {
                quiz.options.forEach((option, index) => {
                    const optionButton = document.createElement('button');
                    optionButton.className = 'mcq-option';
                    optionButton.innerHTML = option.text; // HTML 태그(①, ②, ③) 포함 가능하도록 innerHTML 사용
                    optionButton.setAttribute('data-correct', option.correct);
                    optionButton.setAttribute('data-option-index', index); // 선택된 옵션 식별
                    optionButton.addEventListener('click', (event) => {
                        // 모든 옵션에서 'selected' 클래스 제거
                        document.querySelectorAll('.mcq-option').forEach(btn => btn.classList.remove('selected'));
                        // 현재 클릭된 옵션에 'selected' 클래스 추가
                        event.currentTarget.classList.add('selected');
                        selectedOptionButton = event.currentTarget; // 선택된 버튼 저장
                        
                        // MCQ는 선택 즉시 정답 확인 (단답형과 다름)
                        checkMcqAnswer(option.correct);
                    });
                    quizAnswerArea.appendChild(optionButton);
                });
            }

            quizModal.classList.remove('hidden');
        }

        // 퀴즈 모달 닫기
        function closeModal() {
            quizModal.classList.add('hidden');
        }

        // 단답형 정답 확인
        function checkShortAnswer() {
            const input = document.getElementById('shortAnswerInput').value;
            // 정답 문자열을 공백 제거하고 비교, 입력값에도 정답이 포함되는지 확인
            const answer = currentQuiz.answer.replace(/\s/g, '');
            const userInput = input.trim().replace(/\s/g, '');
            
            const isCorrect = userInput.includes(answer) || answer.includes(userInput);
            handleAnswerResult(isCorrect);
        }

        // 객관식 정답 확인
        function checkMcqAnswer(isCorrect) {
            // 모든 옵션 버튼 비활성화
            document.querySelectorAll('.mcq-option').forEach(btn => btn.disabled = true);

            if (isCorrect) {
                if (selectedOptionButton) {
                    selectedOptionButton.classList.add('correct-answer');
                }
            } else {
                if (selectedOptionButton) {
                    selectedOptionButton.classList.add('wrong-answer');
                }
                // 오답일 경우 정답 표시 (선택되지 않은 정답 버튼을 찾아서 표시)
                const correctAnswerButton = Array.from(document.querySelectorAll('.mcq-option'))
                                                .find(btn => btn.getAttribute('data-correct') === 'true');
                if (correctAnswerButton && correctAnswerButton !== selectedOptionButton) {
                    correctAnswerButton.classList.add('correct-answer');
                }
            }
            handleAnswerResult(isCorrect);
        }

        // 정답/오답 공통 처리
        function handleAnswerResult(isCorrect) {
            // 시도했으므로 버튼 비활성화 및 숨김
            if (currentButtonElement) {
                currentButtonElement.classList.add('hidden');
                currentButtonElement.disabled = true;
            }

            if (isCorrect) {
                quizResult.textContent = "정답입니다! [재료 획득]";
                quizResult.className = "mt-4 text-lg text-center font-bold h-6 glow";
                
                if (collectedIngredients < 3) {
                    collectedIngredients++;
                    updateIngredientUI();
                }

                if (collectedIngredients === 3) {
                    setTimeout(() => {
                        closeModal();
                        showCompletionModal();
                    }, 1500); // 1.5초 후 완료 모달
                    return; // 완료 모달이 뜰 것이므로 조기 리턴
                }

            } else {
                quizResult.textContent = "오답입니다...";
                quizResult.className = "mt-4 text-lg text-center font-bold h-6 text-red-500";
            }

            // 1.5초 후 모달 닫기
            setTimeout(closeModal, 2000); // 2초로 연장하여 결과 확인 시간 주기
        }

        // 완료 모달 표시
        function showCompletionModal() {
            completionModal.classList.remove('hidden');
        }

        // --- 6. 이벤트 리스너 연결 ---
        document.addEventListener('DOMContentLoaded', () => {
            createVirusIcons(10); // 10개의 바이러스 아이콘 생성
            initGame(); // 페이지 로드 시 키워드 생성
        });
        startButton.addEventListener('click', startGame);
        resetButton.addEventListener('click', resetGame);
        closeModalButton.addEventListener('click', closeModal);
        keywordGrid.addEventListener('click', handleKeywordClick);

    </script>
</body>
</html>
