<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>정책 실행 랩 백신 연구소</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    
    <style>
        /* 픽셀 느낌의 레트로 폰트 (대체) */
        @import url('https://fonts.googleapis.com/css2?family=VT323&family=Nanum+Gothic+Coding&display=swap');

        body {
            /* 'Nanum Gothic Coding'은 한글 지원, 'VT323'은 영문/숫자에 레트로 느낌 */
            font-family: 'Nanum Gothic Coding', 'VT323', monospace;
            background-color: #0a0a0a; /* 완전한 검정색에 가까운 배경 */
            color: #00ff00; /* 밝은 녹색 텍스트 */
            text-shadow: 0 0 5px #00ff00, 0 0 2px #00ff00; /* 텍스트 네온 'glow' 효과 */
        }

        /* 공통 레트로 버튼 스타일 */
        .btn-retro {
            display: inline-block;
            padding: 10px 20px;
            font-size: 1.1rem;
            color: #00ff00;
            background-color: #1a1a1a;
            border: 2px solid #00ff00;
            box-shadow: inset 0 0 5px #00ff00, 0 0 5px #00ff00;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .btn-retro:hover {
            color: #0a0a0a;
            background-color: #00ff00;
            box-shadow: inset 0 0 10px #000000, 0 0 15px #00ff00;
        }
        .btn-retro:active {
            transform: translateY(2px);
        }

        /* 키워드 박스 */
        .keyword-box {
            @apply flex flex-col items-center justify-center p-4 text-center break-keep;
            background-color: #111;
            border: 2px solid #008f00;
            color: #00ff00;
            min-height: 100px;
            font-size: 1.2rem;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .keyword-box:hover {
            background-color: #222;
            border-color: #00ff00;
            box-shadow: 0 0 10px #00ff00;
        }

        /* 모달 오버레이 */
        .modal-overlay {
            @apply fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4;
        }

        /* 모달 컨텐츠 박스 */
        .modal-box {
            @apply bg-gray-900 border-2 border-green-500 p-6 shadow-lg relative;
            box-shadow: 0 0 20px #00ff00;
            width: 90%;
            max-width: 600px;
        }

        /* 모달 닫기 버튼 */
        .modal-close-btn {
            @apply absolute top-2 right-3 text-2xl text-green-500 hover:text-white;
        }

        /* MCQ 옵션 버튼 */
        .mcq-option {
            @apply w-full p-3 my-2 text-left;
            background-color: #1a1a1a;
            border: 1px solid #008f00;
            color: #00ff00;
        }
        .mcq-option:hover {
            background-color: #008f00;
            color: #0a0a0a;
        }

        /* 단답형 입력 */
        .short-answer-input {
            @apply w-full p-2 bg-gray-800 border-2 border-green-500 text-green-400 focus:outline-none focus:border-green-300;
        }

        /* 빛나는 아이콘/텍스트 */
        .glow {
            color: #00ff00;
            text-shadow: 0 0 8px #00ff00, 0 0 10px #00ff00;
        }
    </style>
</head>
<body class="min-h-screen p-4">

    <div id="startScreen" class="flex flex-col items-center justify-center min-h-[80vh] text-center">
        <i class="fa-solid fa-flask-vial fa-4x glow mb-6"></i>
        <h1 class="text-3xl md:text-5xl font-bold mb-4">정책 실행 랩 백신 연구소</h1>
        <p class="text-xl md:text-2xl mb-8">[ 백신 개발에 참여하시겠습니까? ]</p>
        <div>
            <button id="startButton" class="btn-retro mx-2">
                <i class="fa-solid fa-check mr-2"></i> 예
            </button>
            <button class="btn-retro mx-2 opacity-50 cursor-not-allowed" title="이 연구소에서 '아니오'는 없습니다.">
                <i class="fa-solid fa-times mr-2"></i> 아니오
            </button>
        </div>
    </div>

    <div id="gameScreen" class="hidden max-w-4xl mx-auto">
        <div class="border-2 border-green-500 p-4 mb-6">
            <h2 class="text-xl font-bold mb-2">:: 연구소 지침 ::</h2>
            <p>문제를 풀 때마다 재료를 하나씩 모으게 되며, 세 개의 재료를 통해 백신을 제작할 수 있습니다. 자신 있는 키워드의 문제를 풀어주시기 바랍니다.</p>
            
            <h3 class="mt-4 text-lg font-bold">:: 백신 재료 획득 현황 ::</h3>
            <div id="ingredientSlots" class="flex space-x-4 text-4xl mt-2">
                </div>
        </div>

        <div id="keywordGrid" class="grid grid-cols-2 md:grid-cols-5 gap-4">
            </div>
    </div>

    <div id="quizModal" class="modal-overlay hidden">
        <div class="modal-box">
            <button id="closeModalButton" class="modal-close-btn">&times;</button>
            
            <h3 class="text-xl md:text-2xl font-bold mb-4 glow" id="quizQuestion">
                [질문]
            </h3>

            <div id="quizAnswerArea" class="my-4">
                </div>
            
            <button id="submitAnswerButton" class="btn-retro w-full hidden">
                <i class="fa-solid fa-paper-plane mr-2"></i> 답변 제출
            </button>

            <p id="quizResult" class="mt-4 text-lg text-center font-bold h-6"></p>
        </div>
    </div>

    <div id="completionModal" class="modal-overlay hidden">
        <div class="modal-box text-center">
            <i class="fa-solid fa-award fa-4x glow mb-6"></i>
            <h2 class="text-3xl font-bold mb-4">백신 개발 완료!</h2>
            <p class="text-xl mb-8">도움을 주셔서 감사합니다!</p>
            <button id="resetButton" class="btn-retro">
                <i class="fa-solid fa-rotate-left mr-2"></i> 처음으로
            </button>
        </div>
    </div>


    <script>
        // --- 1. 퀴즈 데이터 정의 ---
        const quizzes = [
            {
                id: 1,
                keyword: "골든타임",
                type: "short",
                question: "심정지 상황에서 뇌 손상을 최소화하기 위해서는 발견 후 몇 분 이내에 심폐소생술을 시작하는 것이 가장 좋을까요?",
                answer: "4분" // "4분"을 포함하면 정답
            },
            {
                id: 2,
                keyword: "현장 안전 수칙",
                type: "mcq",
                question: "응급처치를 시행하기 전 가장 먼저 해야 할 일은 무엇일까요?",
                options: [
                    { text: "① 119 신고하기", correct: false },
                    { text: "② 환자에게 물 주기", correct: false },
                    { text: "③ 자신의 안전 확보하기", correct: true }
                ]
            },
            {
                id: 3,
                keyword: "환자 반응 확인",
                type: "short",
                question: "심폐소생술(CPR) 시 첫 번째 단계는 환자의 (   )을/를 확인하는 것이다.",
                answer: "반응"
            },
            {
                id: 4,
                keyword: "자동심장충격기 (AED)",
                type: "mcq",
                question: "자동심장충격기(AED)를 사용할 때 올바르지 않은 행동은?",
                options: [
                    { text: "① 음성 안내에 따라 전극 패드를 부착한다.", correct: false },
                    { text: "② 사용 중에는 환자의 몸을 만지지 않는다.", correct: false },
                    { text: "③ 전원이 켜지기 전에 가슴 압박을 멈춘다.", correct: true }
                ]
            },
            {
                id: 5,
                keyword: "화상 응급처치",
                type: "short",
                question: "화상을 입은 경우, 화상 부위는 최소 몇 분 이상 차가운 물로 식혀야 할까요?",
                answer: "15분" // "15분"을 포함하면 정답
            },
            {
                id: 6,
                keyword: "심장 압박의 원리",
                type: "mcq",
                question: "심폐소생술 중 가슴 압박을 하는 이유는 무엇일까요?",
                options: [
                    { text: "① 심장을 쉬게 하기 위해", correct: false },
                    { text: "② 뇌에 혈류를 공급하기 위해", correct: true },
                    { text: "③ 폐의 공기를 제거하기 위해", correct: false }
                ]
            },
            {
                id: 7,
                keyword: "구조 요청 프로토콜",
                type: "short",
                question: "환자의 반응이 없을 때는 주변 사람에게 (   )을/를 요청하고 AED를 가져오게 한다.",
                answer: "119 신고"
            },
            {
                id: 8,
                keyword: "환자 이송법",
                type: "mcq",
                question: "부상자를 이동시켜야 할 때 올바른 방법은?",
                options: [
                    { text: "① 부상 부위를 먼저 잡아 끈다.", correct: false },
                    { text: "② 고정하지 않고 바로 옮긴다.", correct: false },
                    { text: "③ 부목으로 고정한 뒤 이송한다.", correct: true }
                ]
            },
            {
                id: 9,
                keyword: "기도 폐쇄 대처",
                type: "short",
                question: "기도가 막힌 사람이 기침을 세게 할 수 있으면 (       )을/를 하지 않는다.",
                answer: "복부 밀어내기"
            },
            {
                id: 10,
                keyword: "긴급 신고 요령",
                type: "mcq",
                question: "심폐소생술 시 119 신고와 AED 요청을 할 때 가장 바람직한 행동은?",
                options: [
                    { text: "① 조용히 혼자 신고한다.", correct: false },
                    { text: "② 큰 소리로 주변 사람을 지목하여 요청한다.", correct: true },
                    { text: "③ AED 없이도 그냥 압박만 한다.", correct: false }
                ]
            }
        ];

        // --- 2. DOM 요소 선택 ---
        const startScreen = document.getElementById('startScreen');
        const gameScreen = document.getElementById('gameScreen');
        const startButton = document.getElementById('startButton');
        
        const ingredientSlots = document.getElementById('ingredientSlots');
        const keywordGrid = document.getElementById('keywordGrid');

        const quizModal = document.getElementById('quizModal');
        const closeModalButton = document.getElementById('closeModalButton');
        const quizQuestion = document.getElementById('quizQuestion');
        const quizAnswerArea = document.getElementById('quizAnswerArea');
        const submitAnswerButton = document.getElementById('submitAnswerButton');
        const quizResult = document.getElementById('quizResult');

        const completionModal = document.getElementById('completionModal');
        const resetButton = document.getElementById('resetButton');

        // --- 3. 게임 상태 변수 ---
        let collectedIngredients = 0;
        let currentQuiz = null;
        let currentButtonElement = null;

        // --- 4. 핵심 함수 ---

        // 게임 초기화 (키워드 버튼 생성)
        function initGame() {
            keywordGrid.innerHTML = ''; // 그리드 비우기
            quizzes.forEach(quiz => {
                const button = document.createElement('button');
                button.className = 'keyword-box';
                button.setAttribute('data-quiz-id', quiz.id);
                button.innerHTML = `<i class="fa-solid fa-file-alt fa-2x mb-2"></i> ${quiz.keyword}`;
                keywordGrid.appendChild(button);
            });
            updateIngredientUI();
        }

        // 게임 시작
        function startGame() {
            startScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            collectedIngredients = 0;
            updateIngredientUI();
            
            // 모든 키워드 버튼 다시 보이게
            document.querySelectorAll('.keyword-box').forEach(btn => {
                btn.classList.remove('hidden');
                btn.disabled = false;
            });
        }

        // 게임 리셋
        function resetGame() {
            completionModal.classList.add('hidden');
            gameScreen.classList.add('hidden');
            startScreen.classList.remove('hidden');
            // initGame()을 다시 호출하여 버튼을 재생성하고 UI를 초기화합니다.
            initGame();
        }

        // 재료 UI 업데이트
        function updateIngredientUI() {
            ingredientSlots.innerHTML = '';
            for (let i = 0; i < 3; i++) {
                if (i < collectedIngredients) {
                    ingredientSlots.innerHTML += '<i class="fa-solid fa-vial-virus glow"></i>';
                } else {
                    ingredientSlots.innerHTML += '<i class="fa-regular fa-circle opacity-50"></i>';
                }
            }
        }

        // 키워드 클릭 처리 (이벤트 위임)
        function handleKeywordClick(e) {
            const button = e.target.closest('.keyword-box');
            if (!button || button.disabled) return;

            const quizId = button.getAttribute('data-quiz-id');
            currentQuiz = quizzes.find(q => q.id == quizId);
            currentButtonElement = button; // 현재 클릭된 버튼 저장

            openQuizModal(currentQuiz);
        }

        // 퀴즈 모달 열기
        function openQuizModal(quiz) {
            quizQuestion.textContent = quiz.question;
            quizAnswerArea.innerHTML = ''; // 답변 영역 초기화
            quizResult.textContent = ''; // 결과 메시지 초기화
            submitAnswerButton.classList.add('hidden'); // 제출 버튼 숨기기

            if (quiz.type === 'short') {
                quizAnswerArea.innerHTML = '<input type="text" id="shortAnswerInput" class="short-answer-input" placeholder="정답을 입력하세요...">';
                submitAnswerButton.classList.remove('hidden'); // 단답형일 때만 제출 버튼 표시
            } else if (quiz.type === 'mcq') {
                quiz.options.forEach(option => {
                    const optionButton = document.createElement('button');
                    optionButton.className = 'mcq-option';
                    optionButton.textContent = option.text;
                    optionButton.setAttribute('data-correct', option.correct);
                    optionButton.addEventListener('click', () => checkMcqAnswer(option.correct));
                    quizAnswerArea.appendChild(optionButton);
                });
            }

            quizModal.classList.remove('hidden');
        }

        // 퀴즈 모달 닫기
        function closeModal() {
            quizModal.classList.add('hidden');
        }

        // 단답형 정답 확인
        function checkShortAnswer() {
            const input = document.getElementById('shortAnswerInput').value;
            // 정답 문자열을 공백 제거하고 비교, 입력값에도 정답이 포함되는지 확인
            const answer = currentQuiz.answer.replace(/\s/g, '');
            const userInput = input.trim().replace(/\s/g, '');
            
            const isCorrect = userInput.includes(answer) || answer.includes(userInput);
            handleAnswerResult(isCorrect);
        }

        // 객관식 정답 확인
        function checkMcqAnswer(isCorrect) {
            handleAnswerResult(isCorrect);
        }

        // 정답/오답 공통 처리
        function handleAnswerResult(isCorrect) {
            // 시도했으므로 버튼 비활성화 및 숨김
            currentButtonElement.classList.add('hidden');
            currentButtonElement.disabled = true;

            if (isCorrect) {
                quizResult.textContent = "정답입니다! [재료 획득]";
                quizResult.className = "mt-4 text-lg text-center font-bold h-6 glow";
                
                if (collectedIngredients < 3) {
                    collectedIngredients++;
                    updateIngredientUI();
                }

                if (collectedIngredients === 3) {
                    setTimeout(() => {
                        closeModal();
                        showCompletionModal();
                    }, 1500); // 1.5초 후 완료 모달
                    return; // 완료 모달이 뜰 것이므로 조기 리턴
                }

            } else {
                quizResult.textContent = "오답입니다...";
                quizResult.className = "mt-4 text-lg text-center font-bold h-6 text-red-500";
            }

            // 1.5초 후 모달 닫기
            setTimeout(closeModal, 1500);
        }

        // 완료 모달 표시
        function showCompletionModal() {
            completionModal.classList.remove('hidden');
        }

        // --- 5. 이벤트 리스너 연결 ---
        document.addEventListener('DOMContentLoaded', initGame); // 페이지 로드 시 키워드 생성
        startButton.addEventListener('click', startGame);
        resetButton.addEventListener('click', resetGame);
        closeModalButton.addEventListener('click', closeModal);
        keywordGrid.addEventListener('click', handleKeywordClick);
        submitAnswerButton.addEventListener('click', checkShortAnswer);

    </script>
</body>
</html>
